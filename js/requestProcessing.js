// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
let requestsData = {
    requests: [],
    chatHistory: []
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    loadRequests();
    initChatBot();
    initRequestForm();
});

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏
async function loadRequests() {
    try {
        // TODO: –ó–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π
        // –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        requestsData.requests = [
            {
                id: 1,
                type: 'technical',
                text: '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–æ–ø–ª–µ–Ω–∏–µ',
                status: 'completed',
                date: '2025-02-15',
                contactMethod: 'phone',
                contactInfo: '+7(999)123-45-67'
            },
            {
                id: 2,
                type: 'billing',
                text: '–í–æ–ø—Ä–æ—Å –ø–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º',
                status: 'processing',
                date: '2025-02-16',
                contactMethod: 'email',
                contactInfo: 'user@example.com'
            }
        ];
        updateRequestsList();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–±—Ä–∞—â–µ–Ω–∏–π:', error);
    }
}

function updateRequestsList() {
    const requestsList = document.getElementById('requestsList');
    requestsList.innerHTML = requestsData.requests.map(request => `
        <div class="request-item">
            <div class="request-date">${formatDate(request.date)}</div>
            <div class="request-info">
                <div class="request-type">${getRequestTypeText(request.type)}</div>
                <div class="request-text">${request.text}</div>
            </div>
            <div class="request-status status-${request.status}">${getStatusText(request.status)}</div>
        </div>
    `).join('');
}

function initRequestForm() {
    const form = document.getElementById('requestForm');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = {
            type: document.getElementById('requestType').value,
            text: document.getElementById('requestText').value,
            contactMethod: document.getElementById('contactMethod').value,
            contactInfo: document.getElementById('contactInfo').value,
            date: new Date().toISOString().split('T')[0],
            status: 'new'
        };

        try {
            // TODO: –ó–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è:', formData);
            // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
            requestsData.requests.unshift({
                id: requestsData.requests.length + 1,
                ...formData
            });
            updateRequestsList();
            form.reset();
            showNotification('–û–±—Ä–∞—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ–±—Ä–∞—â–µ–Ω–∏—è:', error);
            showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ–±—Ä–∞—â–µ–Ω–∏—è', 'error');
        }
    });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç-–±–æ—Ç–æ–º
function initChatBot() {
    const chatInput = document.getElementById('chatInput');
    const sendButton = document.getElementById('sendMessage');

    sendButton.addEventListener('click', () => sendMessage());
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
}

async function sendMessage() {
    const chatInput = document.getElementById('chatInput');
    const message = chatInput.value.trim();
    if (!message) return;

    try {
        addMessageToChat('user', message);
        chatInput.value = '';
        chatInput.disabled = true;

        // TODO: –ó–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–∏—Å—É —á–∞—Ç-–±–æ—Ç–∞
        // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
        const botResponse = await getBotResponse(message);
        
        if (!botResponse) {
            throw new Error('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞');
        }

        addMessageToChat('bot', botResponse);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
        addMessageToChat('bot', '–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    } finally {
        chatInput.disabled = false;
        chatInput.focus();
    }
}

function addMessageToChat(type, text) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message message-${type}`;
    messageDiv.textContent = text;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    requestsData.chatHistory.push({ type, text, timestamp: new Date() });
}

async function getBotResponse(message) {
    const lowerMessage = message.toLowerCase();
    
    // –û–±—ä–µ–∫—Ç —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
    const responses = {
        // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
        '–æ—Ç–æ–ø–ª–µ–Ω–∏–µ': `–ï—Å–ª–∏ —É –≤–∞—Å –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–ø–ª–µ–Ω–∏–µ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ:
1. –í–∞—à —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å
2. –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ—Ç –æ—Ç–æ–ø–ª–µ–Ω–∏—è, —Å–ª–∞–±—ã–π –Ω–∞–≥—Ä–µ–≤, —à—É–º –∏ —Ç.–¥.)
3. –ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞

–í—ã –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –æ–±—Ä–∞—â–µ–Ω–∏—è –≤—ã—à–µ, –≤—ã–±—Ä–∞–≤ —Ç–∏–ø "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞".`,
        '–∞–≤–∞—Ä–∏—è': `–í —Å–ª—É—á–∞–µ –∞–≤–∞—Ä–∏–π–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–æ–æ–±—â–∏—Ç–µ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∞–≤–∞—Ä–∏–π–Ω–æ–π —Å–ª—É–∂–±—ã: +7(856)304-53-31. –î–ª—è –Ω–µ–∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É –æ–±—Ä–∞—â–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ.`,
        '–≥–æ—Ä—è—á–∞—è –≤–æ–¥–∞': `–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –≥–æ—Ä—è—á–∏–º –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏—Ç–µ:
1. –í–∞—à –∞–¥—Ä–µ—Å
2. –•–∞—Ä–∞–∫—Ç–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ—Ç –≤–æ–¥—ã, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞)
3. –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã –ª–∏ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã

–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –æ–±—Ä–∞—â–µ–Ω–∏—è, –≤—ã–±—Ä–∞–≤ "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞".`,
        
        // –í–æ–ø—Ä–æ—Å—ã –æ–ø–ª–∞—Ç—ã
        '–æ–ø–ª–∞—Ç–∞': `–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ–ø–ª–∞—Ç—ã:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
2. –û–ø–ª–∞—Ç–∏—Ç—å —É—Å–ª—É–≥–∏ –º–æ–∂–Ω–æ:
   - –ß–µ—Ä–µ–∑ —Å–∞–π—Ç
   - –í –æ—Ç–¥–µ–ª–µ–Ω–∏—è—Ö –±–∞–Ω–∫–æ–≤
   - –í –∫–∞—Å—Å–∞—Ö —Ä–∞—Å—á–µ—Ç–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞
3. –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å: +7(856)304-53-31`,
        '—Å—á–µ—Ç': `–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Å—á–µ—Ç–∞–º:
1. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π: –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏–ª–∏ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä
2. –°–≤–µ—Ä–∏—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤: +7(856)304-53-31
3. –ó–∞—è–≤–∏—Ç—å –æ –Ω–µ—Å–æ–≥–ª–∞—Å–∏–∏ —Å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º–∏: —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –æ–±—Ä–∞—â–µ–Ω–∏—è`,
        '–¥–æ–ª–≥': `–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É–º–º—É –¥–æ–ª–≥–∞: –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏–ª–∏ +7(856)304-53-31
2. –û—Ñ–æ—Ä–º–∏—Ç—å —Ä–∞—Å—Å—Ä–æ—á–∫—É: –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä
3. –û—Å–ø–æ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è: —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –æ–±—Ä–∞—â–µ–Ω–∏—è`,
        
        // –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
        '–≥—Ä–∞—Ñ–∏–∫': `–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
–ü–Ω-–ü—Ç: 8:00 - 17:00
–û–±–µ–¥: 12:00 - 13:00
–°–±-–í—Å: –≤—ã—Ö–æ–¥–Ω–æ–π

–ê–≤–∞—Ä–∏–π–Ω–∞—è —Å–ª—É–∂–±–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ: +7(856)304-53-31`,
        '–∫–æ–Ω—Ç–∞–∫—Ç—ã': `–ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã:
1. –¢–µ–ª–µ—Ñ–æ–Ω: +7(856)304-53-31
2. Email: donbassteploenergo@mail.ru
3. –ê–¥—Ä–µ—Å: —É–ª. –õ–µ–Ω–∏–Ω–∞, 15

–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã:
–ü–Ω-–ü—Ç: 8:00 - 17:00`,
        '–¥–æ–∫—É–º–µ–Ω—Ç—ã': `–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è:
1. –ü–∞—Å–ø–æ—Ä—Ç
2. –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
3. –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏

–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –æ—Ñ–∏—Å –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –æ–±—Ä–∞—â–µ–Ω–∏—è.`
    };

    // –ü–æ–∏—Å–∫ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    for (const [keyword, response] of Object.entries(responses)) {
        if (lowerMessage.includes(keyword)) {
            return response;
        }
    }

    // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    return `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –∫–æ–º–ø–∞–Ω–∏–∏ "–î–æ–Ω–±–∞—Å—Å—Ç–µ–ø–ª–æ—ç–Ω–µ—Ä–≥–æ".

–Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –≤–æ–ø—Ä–æ—Å–∞–º:

1. üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
   ‚Ä¢ –û—Ç–æ–ø–ª–µ–Ω–∏–µ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –¥–∞–≤–ª–µ–Ω–∏–µ, —à—É–º)
   ‚Ä¢ –ì–æ—Ä—è—á–µ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
   ‚Ä¢ –ê–≤–∞—Ä–∏–π–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏

2. üí∞ –í–æ–ø—Ä–æ—Å—ã –æ–ø–ª–∞—Ç—ã:
   ‚Ä¢ –ù–∞—á–∏—Å–ª–µ–Ω–∏—è –∏ —Ç–∞—Ä–∏—Ñ—ã
   ‚Ä¢ –°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
   ‚Ä¢ –ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –∏ —Ä–∞—Å—Å—Ä–æ—á–∫–∞

3. ‚ÑπÔ∏è –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
   ‚Ä¢ –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
   ‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   ‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

–î–ª—è —Å—Ä–æ—á–Ω—ã—Ö –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π:
–¢–µ–ª–µ—Ñ–æ–Ω –∞–≤–∞—Ä–∏–π–Ω–æ–π —Å–ª—É–∂–±—ã (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ): +7(856)304-53-31

–î–ª—è –ø–æ–¥–∞—á–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Ñ–æ—Ä–º–æ–π –≤—ã—à–µ.
–ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å–µ–π—á–∞—Å?`;
    }


// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function formatDate(dateString) {
    return new Date(dateString).toLocaleDateString('ru-RU');
}

function getRequestTypeText(type) {
    const types = {
        technical: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞',
        billing: '–í–æ–ø—Ä–æ—Å—ã –ø–æ –æ–ø–ª–∞—Ç–µ',
        service: '–ö–∞—á–µ—Å—Ç–≤–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è',
        other: '–î—Ä—É–≥–æ–µ'
    };
    return types[type] || type;
}

function getStatusText(status) {
    const statuses = {
        new: '–ù–æ–≤–æ–µ',
        processing: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
        completed: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ',
        rejected: '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
    };
    return statuses[status] || status;
}

function showNotification(message, type = 'success') {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    alert(message);
}